language: node_js

cache: yarn

node_js:
  - 8
  - 10

before_install:
  - npm i -g yarn

script:
  - yarn lint
  - yarn build
  - yarn test

# Environment variables marked with `secure` should be securely encrypted as described at:
# https://docs.travis-ci.com/user/environment-variables/#encrypting-environment-variables

notifications:
  slack:
    rooms:
      - secure: 0qsJTpdgHmV0FqX0CY/FRAIkRSFCdUwl4x5HtkUk3we+w7VIyMNOHH8SLMnJxi4iNaEBaPA+dK26w04gQS4jmon79zSpJiv+WcsJ2PBGfLlhNjWNjOLeKc4ndon58SmW6usRkNa6Uh6+o9o7xuhfngSyOviKhxe6fQtMBbOLtfaVwOBAfnaDZ9cpH+nSCIZXVMI8HjU5ZKcyxR8IXMovJhjl4Wc9clijiVnVSx/vtt8SIzniqxJ6HndGqabWLxjKUY+gy6P2iE+3/nrMmMNpE9drRI19PqVElGOlt/Y5teWi5EuMxmpX2LpUGiYn/1ivHBP1u1drs97qpmcE6/fAPKfxZ2lyy7787n2+HD5XRjUfmMl2IW/2npTER/3sC3F56yzxyMTWdHGsTG4jHfUc2ikNkw2N80cd3vSXz7AaR/HDMGSZskR3kT737vutldtBFu7xJNw/wQGIsX+uQtJE8f5fVVUf96pucduqi6+tgMnhIVe0ET7lLBMP4HCBYvpjerYtOlrfcbeXrrf4Iouy73i3W55k8pY2eMVuKiH+g3bGKkSk4K9RJTD+NrO3+Tqnnti/gsof5wDU111RsU9nfyY8Cxq6oeQAbNHlUyDUdW7J/su2oSqjuJemqu7TSdfuIbGPAP6Rri2nNMaw3Xkha77UA8NS4r/buTrIJ+wBlYQ=
    on_success: change
    on_failure: always

env:
  global:
    - secure: zBrnX5EkjSvyCL4bMZaQU7VIxmf/yEKqsWi7FMEiWvjuYKwdfEMWs64MEXvy/FPpVY3E1FEpTo7Qgeg+43cpMRuJBLrlgmY2poTOBq95UHqThCsWXBPsDEtOp8Csw3zB544JvGCdP1Iwrkr3dNNYI/bkwh9MP2Nz2bsUR90DxilYiyZLLA6Q5AUJcbDrv/eTVMZOxD2X1CTGLK0vpzXWjYpVGRyaxP8NCmtp21SfsUSV9l5rfdiy1HC2FtA1zePN14pEPe8c22qC2pzml7TGjClSKfjzC+Re+Kckslh7y1mHYXJIl/8xnboPYaaC9LK5QU2BkdyhLJy8I+Qusu+PwUdlRmGIDnfIRf/SG+XEan5lY8eL8WkWuIBLvOLxCJuUR4T+psrqMho/He24C0Zk7a1e4NzIbhMwbv8aggQCvXNXiy9hA1CvTmj/9cRCxzx17+1k9LU64GXaUQ+5aUiGqeyQC/ZbRFYT0AYQgWmHruf7gDHlVj8L6aBtpo4KZAFZYge3ee4qkoXcfU+mOywFvKrwcsss6IWEigpx8Vdg0sqRQs4FV3zeMRpNwLpSr4LaRxTaAGC9rdup3jvYIoltwoUJauhf3NfJnOzsLaMLn2zWzl1+hZPR+BciM2CfzIfZfXLHzXhHYDh/nYkQV2+1eOKRFPhnVuaJ6OXt1XhXsLU=
    - secure: AhdVtmNj+VubXEuEscUyxPsHIOGIEjXnTKXQYHs/AJA7CvMpb8J1tq64aXEnrDjdHc/G7Fuv9aqs58nY/Qmwbxoqv9cz1ra5mXpav6suqKMBydmVYy0hc91vJzB/VNDRSo8Nq2umqAabES5iDFJQ6YSKLDUSWajZj8naIRNzjFY6XSntPmCD1UtlkzB51+Y7nwtR2uF2imcDWzBbq8vUofxD/Kimgu/OB9rAOypX1wbxcJvVWjffgxZmQU16LUZ0mLxk4XFeJ+dfR0c02tST7knW1PN4ZsiOnsbMvmXt9IomcBAwZgTZdlNN+FY3AiwAktAovWpkPjuhhEczDVNh7KJs7AoEjVbytHasVzvh3fCrmQYkKehbERzu/kBoP16bH/7KiB7r4qnh0kjr5l24u4Q+ZCPP3Kotfyc3Hdi5vWaeOiqHXlzdsf9PDJSVMvPrnsyMhlUWPkta6cCoDrth210FpXHriHqgtx1NAki2GjwUQJOQ2RQnSwI8OU210IOktSoRBlwbwKRulStW/wr471ERsTcrw7rpFbd30Blf06cQ2U0d+ELn2QFOBxftbBKFZLdaSfKtDH8PusZ+7CgaKuGB7jjkB3DQZIZEe5L/Wqi+rMJCNOBliDRA4yFqVS1MvvuyaXT6bJmljNkJ5LWOXDdeNx00b2ybYEeuGcvuyg4=
    - secure: 4WcJF8RogmTGnlaQRuZn8XrGOy1xTVH7kj+x09NzPhVSRzeibBsop1hPSxagaMjUBQFHildlna8EQLUuPtoeDiTdJq6UO/RqPzvowU/NU8B/fO5VD/IZ8B26qOrbLYxc1GNYSGtl2Rmb4HaVFhmUz4agTu+YmT++UCSLzjy3ZbfHUXe6sSCQwykrhcT/799KVR4nRgIg02ZPiLE2VOfZd1w9b+Y3u1+cXbipsj1ORvQwETrF9oWpzdW1P9fRtZ1zYPCUBF6sBiEtI2VgG6BA2FgVo8VTS0Vh6qJKhvJnBtXjpliFi46GlKsXxx0/w0fuBTKKMJU0JVO95nzu9nqlWWqx32LtAVfojfHEldLwzjTZUllAPlCEAsXci8UzCxFanFWvaqljlJ3e+LYhhTt2vvO8DIxhaUtklOPQzvN7emAX5eYf9jpslte9nn+7yovmN9mpdaJybjA0ZOfhrMMgF2nf6WpW2KvC5ES9Su5/1nxZ9FgyyqIiWqTz02gEF90C2FQ44JUCFXpJ/qQGsTnJbR+VIYQlWbo+X3XGuAjHfl0Q8xR4eveyBiFqPcrxao6iWju/FhPsH38pk+sJUFNNjnCzWgpnkjz49ldQrjgueF6iHCvupXjCCsZKo1Ui7dOU6yPMpIAQfSuVpRuKJDqDBmtI49BLnULTxbo7U0RpgX4=
    - export GIT_AUTHOR_NAME="esg-bot"
    - export GIT_AUTHOR_EMAIL="tech@endemolshine.com"
    - export GIT_COMMITTER_NAME="esg-bot"
    - export GIT_COMMITTER_EMAIL="tech@endemolshine.com"

jobs:
  include:
    - stage: coverage
      if: type != pull_request
      before_script:
        - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
        - chmod +x ./cc-test-reporter
        - ./cc-test-reporter before-build
      after_script:
        - ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT
      after_success:
        - yarn global add codecov
        - codecov
    - stage: release
      if: branch = master AND type != pull_request
      after_success:
        - yarn semantic-release
        - git clone https://${GH_TOKEN}@github.com/$TRAVIS_REPO_SLUG.git $TRAVIS_REPO_SLUG
        - cd $TRAVIS_REPO_SLUG
        - git fetch --all
        - git merge origin/master
        - git push
